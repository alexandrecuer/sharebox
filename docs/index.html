<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.28
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><table>
  <thead>
    <tr>
      <th>rails</th>
      <th><a href="https://github.com/rails/jquery-rails/blob/master/VERSIONS.md">jquery-rails</a></th>
      <th>bootstrap</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>7.0.3.1</td>
      <td>4.5</td>
      <td>5.2</td>
    </tr>
  </tbody>
</table>

<h1 id="a-business-social-network-tool-dedicated-to-quality-management">A business social network tool dedicated to quality management</h1>

<p>This application is a SharingFile System with surveys management facilities or an open source CRM - Client Relation Management</p>

<p><a href="https://github.com/alexandrecuer/sharebox/actions/workflows/ruby.yml"><img src="https://github.com/alexandrecuer/sharebox/actions/workflows/ruby.yml/badge.svg" alt="Ruby" /></a>
<a href="https://www.codacy.com/app/alexandrecuer/sharebox?utm_source=github.com&amp;utm_medium=referral&amp;utm_content=alexandrecuer/sharebox&amp;utm_campaign=Badge_Grade"><img src="https://api.codacy.com/project/badge/Grade/ed6f26a2613349e0a92b404d515a4b29" alt="Codacy Badge" /></a></p>

<p>Deliver files and documents to your clients and Record your clients’satisfaction
&lt;img src=public/images/doc/colibri_front.png&gt;</p>

<p>Online class documentation (not up to date) :
https://alexandrecuer.github.io/sharebox/</p>

<p>documentation is generated by yard (just launch <code>yard doc</code> in the root folder)</p>

<p>Check online prototype : http://cerema-autun.herokuapp.com</p>

<p>Check the wiki for architecture details and roadmap : https://github.com/alexandrecuer/sharebox/wiki</p>

<p><b>
An automatic process is available for deployment on a linux Ubuntu server or virtual machine. It will install the required dependencies then the application in /var/www/colibri/sharebox.</b></p>

<p>When installing the server, reserve 8GB at least for the system and create a specific mounting point for /var/www</p>

<p>check : https://github.com/alexandrecuer/colibriScripts
&lt;/b&gt;</p>

<p>Uses the following gems :</p>

<ul>
  <li><a href="https://github.com/plataformatec/devise">devise</a> for user authentification</li>
  <li><a href="https://www.phusionpassenger.com/library/walkthroughs/deploy/ruby/heroku/standalone/oss/deploy_app_main.html">passenger</a> as the application server (in standalone mode)</li>
  <li><a href="https://github.com/aws/aws-sdk-ruby">aws-sdk</a> for storage on S3</li>
</ul>

<p>frontoffice :
* <a href="https://github.com/twbs/bootstrap-rubygem">bootstrap</a>
* <a href="https://github.com/bokmann/font-awesome-rails">font-awesome</a> icons and cosmectic details
* <a href="https://github.com/rails/jquery-rails">jquery rails</a></p>

<h2 id="file-storage">File storage</h2>

<p>The application use rails <a href="http://guides.rubyonrails.org/active_storage_overview.html">ActiveStorage</a> for file storage/documents processing</p>

<p><a href="https://github.com/alexandrecuer/sharebox/issues/8">migration guide from paperclip</a></p>

<p>Document storage is configured for : 
- Amazon S3 in production mode 
- local file system in development mode. In that case, the aws-sdk gem is not used.</p>

<p>corresponding model and controller can be found there :
- <a href="app/models/asset.rb">app/models/asset.rb</a>
- <a href="app/controllers/assets_controller.rb">app/controllers/assets_controller.rb</a> - see the get_file private method</p>

<p>to open a file, follow the route /forge/get/:id</p>

<h3 id="switching-between-s3-and-local-storage">Switching between S3 and local storage</h3>

<p>Modify the value of <strong>config.active_storage.service</strong> in the corresponding config/environments/*.rb file(s)</p>

<ul>
  <li>config.active_storage.service = :local or :local_production &gt; local storage will be activated</li>
  <li>config.active_storage.service = :amazon &gt; all files will go in the S3 bucket</li>
</ul>

<p>let’s take the case of a file with an active_storage_blobs.key value equal to xMRXuT6nqpoiConJFQJFt6c9 :
- if local storage is activated, the file will be stored as rails_root/(storage or production_storage)/xM/RX/xMRXuT6nqpoiConJFQJFt6c9
- if S3 storage is activated, the file will be stored directly at the root of the bucket :  S3 bucket/xMRXuT6nqpoiConJFQJFt6c9</p>

<p>in local storage, if you delete the file the folders xM/RX will remain on disk</p>

<p>in lib/tasks, you can find a rake utility to clean the storage or production_storage folder</p>

<p>just launch :
<code>
bundle exec rake storage:clean_storage['storage']
bundle exec rake storage:clean_storage['storage_production']
</code>
empty folders will be deleted</p>

<h2 id="s3-storage-environmental-variables--to-review">S3 storage environmental variables : TO REVIEW</h2>

<table>
    <tr>
        <td>S3_BUCKET_NAME</td>
        <td>&lt;a href=https://devcenter.heroku.com/articles/s3#s3-setup&gt;Heroku specific doc&lt;/a&gt;</td>
    </tr>
    <tr>
        <td>AWS_REGION</td>
        <td rowspan="2">
            &lt;a href=https://docs.aws.amazon.com/fr_fr/general/latest/gr/rande.html#s3_region&gt;AWS regional parameters&lt;/a&gt;<br /> 
            exemple : <br />
            AWS_REGION=eu-west-3<br />
            AWS_HOST_NAME=s3.eu-west-3.amazonaws.com
        </td> 
    </tr>
    <tr>
        <td>AWS_HOST_NAME</td>
    </tr>
    <tr>
        <td>AWS_URL</td>
        <td>S3_BUCKET_NAME.AWS_HOST_NAME</td>
    </tr>
    <tr>
        <td>AWS_ACCESS_KEY_ID</td>
        <td rowspan="2">
            &lt;a href=https://console.aws.amazon.com/iam/home#/users&gt;IAM - Identity and Access Management&lt;/a&gt;
        </td>
    </tr>
    <tr>
        <td>AWS_SECRET_ACCESS_KEY</td>
    </tr>
</table>

<h2 id="mail-delivery-environmental-variables">Mail delivery Environmental variables</h2>

<table>
    <tr>
        <td>GMAIL_USERNAME</td>
        <td rowspan="2">
          SendGrid is the preferred option<br />
          &lt;a href=https://sendgrid.com/&gt;sendgrid&lt;/a&gt;<br /><br />
          &lt;a href=https://mail.google.com/&gt;gmail&lt;/a&gt;<br />
          Please note gmail is not a reliable solution as a backoffice mailer<br />
          if, however, you were considering using gmail for mail delivery, you may need to configure your google account in order to allow external applications to use it<br />
          &lt;a href=https://www.google.com/settings/security/lesssecureapps&gt;lesssecureapps&lt;/a&gt;<br />
          &lt;a href=https://accounts.google.com/DisplayUnlockCaptcha&gt;unlockcaptach&lt;/a&gt;<br />
        </td>
    </tr>
    <tr>
        <td>GMAIL_PASSWORD</td>
    </tr>
    <tr>
        <td>SMTP_ADDRESS</td>
        <td rowspan="2">example if using sendgrid :<br />SMTP_ADDRESS="smtp.sengrid.net"<br />SMTP_PORT=587</td>
    </tr>
    <tr>
      <td>SMTP_PORT</td>
    </tr>
    <tr>
      <td>DOMAIN</td>
      <td>In development mode : localhost<br />For a production server :ip address or domain name of the server</td>
    </tr>
</table>

<h1 id="user-management">User management</h1>

<p>5 different user profiles are available</p>

<h2 id="profile-0--external-user">profile 0 : external user</h2>
<p>customer who is not registered in the tool and who has received a token by email to answer a satisfaction survey not related to a deliverable</p>

<h2 id="profile-1--standard-public-user">profile 1 : standard public user</h2>
<p>customer who wants to access a deliverable and to complete an associated satisfaction survey, if any</p>

<h2 id="profile-2--team-member">profile 2 : team member</h2>
<p>team members can only send customer satisfaction surveys <strong>without</strong> making deliverables available on the cloud</p>

<p>a specific environmental variable TEAM permits to active the profile 2</p>
<table><tr><td>TEAM</td><td>cerema.fr</td></tr></table>

<p>Initialize TEAM with your domain name - otherwise there will be no difference between profile 1 and profile 2</p>

<h2 id="profile-3--private-user">profile 3 : private user</h2>
<p>full team member who dematerializes his productions</p>

<p>Private users can create directories and upload files in folders they don’t own, if they have received shared access - this constitutes a primitive kind of collaborative work</p>

<h2 id="profile-4--admin">profile 4 : admin</h2>
<p>all powers - access to all directories and assets, surveys management, ability to modify directories (moving and changing ownership)</p>

<h1 id="deployment-to-heroku-through-github-integration">Deployment to Heroku through GitHub integration</h1>
<p>This application has been designed for an automatic deployment from github to the heroku cloud
You will need a S3 bucket as Heroku has an ephemeral file system
Here are the main steps :
- Fork and customize the repository to your needs
- Create a new Heroku app and link it to the GitHub repository previously forked
- Fill all the eleven needed config variables (AWS_ACCESS_KEY_ID, AWS_HOST_NAME, AWS_REGION, AWS_SECRET_ACCESS_KEY, AWS_URL, DOMAIN, GMAIL_PASSWORD, GMAIL_USERNAME, S3_BUCKET_NAME, SMTP_ADDRESS, SMTP_PORT plus an extra one: TEAM)
- Proceed to a manual deploy</p>

<p>To customize the application to your needs, check the following files 
- config/config.yml (site_name and admin_mel)
- config/initializers/devise.rb (config.mailer_sender)</p>

<p>admin_mel will receive activity notifications : new shares, pending users. Pending users are unregistered users benefiting from at least one shared access to a folder</p>

<p>config.mailer_sender will be the sending email as far as authentification issues are considered (eg password changes)</p>

<p>You can find the two site’s logos in the /app/assets/images directory</p>

<p>Please note that the first user to register in the system will be given admin rights !!</p>

<p>for more details : <a href="/public/images/doc/deploy_on_heroku.pdf">deploy on heroku in images</a></p>

<h1 id="installation-on-heroku-for-production-from-a-development-server">Installation on Heroku (for production) from a development server</h1>
<p>If you don’t want to use the github integration method, an alternative option is possible</p>

<p>Install <a href="https://devcenter.heroku.com/articles/heroku-cli">Heroku CLI</a></p>

<p>Or https://cli-assets.heroku.com/branches/stable/heroku-windows-amd64.exe</p>

<p>Open your local app directory in a git bash, and login to Heroku :
<code>
$ cd /c/Sites/sharebox
$ heroku login
Enter your Heroku credentials:
Email: alexandre.cuer@cerema.fr
Password: *************
Logged in as alexandre.cuer@cerema.fr
</code>
Once succesfully logged, create a new heroku app :
<code>
$ heroku create
Creating app... done, desolate-earth-32333
https://desolate-earth-32333.herokuapp.com/ | https://git.heroku.com/desolate-earth-32333.git
</code>
Heroku will define a random name for your production server, here : desolate-earth-32333.</p>

<p>Push the files with git.
<code>
$ git init
$ git add .
$ git commit -a -m "Switch to production"
$ git push heroku master
</code>
Fix environmental variables (we assume you are using gmail)
<code>
$ heroku config:set S3_BUCKET_NAME="your_bucket"
$ heroku config:set AWS_REGION="your_region"
$ heroku config:set AWS_HOST_NAME="your_host_name"
$ heroku config:set AWS_URL="your_url"
$ heroku config:set AWS_ACCESS_KEY_ID="your_access_key"
$ heroku config:set AWS_SECRET_ACCESS_KEY="your_secret_access_key"
$ heroku config:set GMAIL_USERNAME="your_gmail_address"
$ heroku config:set GMAIL_PASSWORD="your_gmail_password"
$ heroku config:set SMTP_ADDRESS="smtp.gmail.com"
$ heroku config:set SMTP_PORT=587
$ heroku config:set DOMAIN="desolate-earth-32333.herokuapp.com"
</code>
If for some reason, one variable is not correctly fixed, you can correct it from the heroku dashboard.</p>

<p>Go to https://dashboard.heroku.com/apps &gt; Settings &gt; Reveal Config Vars</p>

<p>Create the database and the tables
<code>
$ heroku run rake db:schema:load
</code></p>

<h1 id="working-behind-a-proxy-server">Working behind a proxy server</h1>

<p>If you work behind a proxy, please set http_proxy and https_proxy variables
<code>
$ export https_proxy="http://user_name:password@proxy_url:proxy_port"
$ export http_proxy="http://user_name:password@proxy_url:proxy_port"
</code></p>

<h1 id="installation-on-a-microsoft-windows-development-machine">Installation on a microsoft windows development machine</h1>

<p>Follow the <a href="public/images/doc/install_on_microsoft_window_dev_machine.md">specific guide</a></p>
</div></div>

      <div id="footer">
  Generated on Sun Jul 24 11:52:50 2022 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.28 (ruby-3.1.2).
</div>

    </div>
  </body>
</html>