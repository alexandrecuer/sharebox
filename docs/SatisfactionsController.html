<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: SatisfactionsController
  
    &mdash; Documentation by YARD 0.9.16
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "SatisfactionsController";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (S)</a> &raquo;
    
    
    <span class="title">SatisfactionsController</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: SatisfactionsController
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActionController::Base</li>
          
            <li class="next"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></li>
          
            <li class="next">SatisfactionsController</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/controllers/satisfactions_controller.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Manage satisfactions creation within the sharebox site<br> A satisfaction
is a form intended for the client to express his satisfaction</p>


  </div>
</div>
<div class="tags">
  

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="DATE_REG_EXP-constant" class="">DATE_REG_EXP =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>([0-9]{4}-[0-9]{2}-[0-9]{2})</span><span class='regexp_end'>/</span></span></pre></dd>
      
    </dl>
  







  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-instance_method" title="#create (instance method)">#<strong>create</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Save a satisfaction answer<br> 2 scenarios : <br> 1) folder_id is &lt;0,
there is no link with an existing folder - the survey is independent<br>   
in that case and at this stage (only), the absolute value of folder_id is
temporary equal to survey_id<br> 2) folder_id is &gt;0 and it is a classic
satisfaction survey associated to an existing folder<br>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#destroy-instance_method" title="#destroy (instance method)">#<strong>destroy</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Destroy a specific satisfaction<br> The show form of the poll_controller
includes a delete button.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#feedback_metas-instance_method" title="#feedback_metas (instance method)">#<strong>feedback_metas</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>show / update meta datas on satisfactions to upgrade from deprecated
versions of colibri (v0 or v1).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#freelist-instance_method" title="#freelist (instance method)">#<strong>freelist</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>to retrieve for a given registered user all ids for the satisfaction
answers collected out of the folders/assets system retieve also, if it
exists, the case_number field for a nicer html output.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#freenew-instance_method" title="#freenew (instance method)">#<strong>freenew</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Show the new form in order to retrieve satisfactions from users not
registered in the Colibri<br> WEAK LOGIC PROCESS 2019<br> please note we
temporary use the folder_id field to store (-1)*@survey id<br> when
satisfaction will be recorded in the database, folder_id field will be
recycled to store the client id.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index-instance_method" title="#index (instance method)">#<strong>index</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>render a json view of ALL satisfactions answers.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#json-instance_method" title="#json (instance method)">#<strong>json</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>render a json output of a given satisfaction<br> used in the surveys view.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new-instance_method" title="#new (instance method)">#<strong>new</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Show the new form in order for public users to express their
satisfaction<br> A public user will access to the form if :<br> - he has a
shared access on the folder <br> - the folder is polled<br> - he has not
already answered to the form<br> Both types of questions, open and closed,
are not required fields.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run-instance_method" title="#run (instance method)">#<strong>run</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>run a filter on the results of a specific poll route is 
/satisfactions/run/:poll_id.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show-instance_method" title="#show (instance method)">#<strong>show</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Show satisfaction answer given a specific id<br> for admins and users with
shared access on the folder related to the satisfaction.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ApplicationController.html#check_lang-instance_method" title="ApplicationController#check_lang (method)">#check_lang</a></span></p>

  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="create-instance_method">
  
    #<strong>create</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Save a satisfaction answer<br> 2 scenarios : <br> 1) folder_id is &lt;0,
there is no link with an existing folder - the survey is independent<br></p>

<pre class="code ruby"><code class="ruby">in that case and at this stage (only), the absolute value of folder_id is temporary equal to survey_id&lt;br&gt;</code></pre>

<p>2) folder_id is &gt;0 and it is a classic satisfaction survey associated to
an existing folder<br></p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/satisfactions_controller.rb', line 244</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:satisfaction</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:folder_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>&lt;</span> <span class='int'>0</span>
    <span class='ivar'>@satisfaction</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Satisfaction.html" title="Satisfaction (class)">Satisfaction</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_satisfaction_params'>satisfaction_params</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_survey'>survey</span><span class='op'>=</span><span class='const'>Survey</span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_folder_id'>folder_id</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_survey'>survey</span>
      <span class='id identifier rubyid_render'>render</span> <span class='label'>plain:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.inexisting</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> \n </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.survey</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.id</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_folder_id'>folder_id</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_poll'>poll</span><span class='op'>=</span><span class='const'>Poll</span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:satisfaction</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:poll_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_poll'>poll</span>
        <span class='id identifier rubyid_render'>render</span> <span class='label'>plain:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.inexisting</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> \n </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.poll</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.id</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:satisfaction</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:poll_id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> 
      <span class='kw'>else</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_poll'>poll</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='op'>!=</span> <span class='id identifier rubyid_survey'>survey</span><span class='period'>.</span><span class='id identifier rubyid_poll_id'>poll_id</span>
          <span class='id identifier rubyid_render'>render</span> <span class='label'>plain:</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.mismatch_poll_ids</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_client_mel'>client_mel</span><span class='op'>=</span><span class='id identifier rubyid_survey'>survey</span><span class='period'>.</span><span class='id identifier rubyid_client_mel'>client_mel</span>
          <span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_case_number'>case_number</span><span class='op'>=</span> <span class='id identifier rubyid_gentitle'>gentitle</span><span class='lparen'>(</span><span class='id identifier rubyid_survey'>survey</span><span class='period'>.</span><span class='id identifier rubyid_description'>description</span><span class='comma'>,</span><span class='id identifier rubyid_survey'>survey</span><span class='period'>.</span><span class='id identifier rubyid_client_mel'>client_mel</span><span class='comma'>,</span><span class='id identifier rubyid_survey'>survey</span><span class='period'>.</span><span class='id identifier rubyid_by'>by</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_client'>client</span><span class='op'>=</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_find_by_mel'>find_by_mel</span><span class='lparen'>(</span><span class='id identifier rubyid_client_mel'>client_mel</span><span class='rparen'>)</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_client'>client</span>
            <span class='comment'># everything should be fine at this stage - we can fix things
</span>            <span class='comment'># folder_id will contain (-1)*client_id
</span>            <span class='comment'># user_id will be the user id of the registered user who launched the interaction
</span>            <span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_user_id'>user_id</span> <span class='op'>=</span> <span class='id identifier rubyid_survey'>survey</span><span class='period'>.</span><span class='id identifier rubyid_user_id'>user_id</span>
            <span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_folder_id'>folder_id</span> <span class='op'>=</span> <span class='op'>-</span><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
            <span class='id identifier rubyid_message'>message</span><span class='op'>=</span><span class='id identifier rubyid_save_free_sat'>save_free_sat</span><span class='lparen'>(</span><span class='ivar'>@satisfaction</span><span class='comma'>,</span> <span class='id identifier rubyid_survey'>survey</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_render'>render</span> <span class='label'>plain:</span> <span class='id identifier rubyid_message'>message</span>              
          <span class='kw'>else</span>
            <span class='comment'># client is not in the base
</span>            <span class='comment'># we save the client without fixing the organisation - it can be done further in the clients controller if needed
</span>            <span class='id identifier rubyid_client'>client</span><span class='op'>=</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
            <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_mel'>mel</span><span class='op'>=</span><span class='id identifier rubyid_survey'>survey</span><span class='period'>.</span><span class='id identifier rubyid_client_mel'>client_mel</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
              <span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_user_id'>user_id</span> <span class='op'>=</span> <span class='id identifier rubyid_survey'>survey</span><span class='period'>.</span><span class='id identifier rubyid_user_id'>user_id</span>
              <span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_folder_id'>folder_id</span> <span class='op'>=</span> <span class='op'>-</span><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
              <span class='id identifier rubyid_message'>message</span><span class='op'>=</span><span class='id identifier rubyid_save_free_sat'>save_free_sat</span><span class='lparen'>(</span><span class='ivar'>@satisfaction</span><span class='comma'>,</span> <span class='id identifier rubyid_survey'>survey</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_render'>render</span> <span class='label'>plain:</span> <span class='id identifier rubyid_message'>message</span>
            <span class='kw'>else</span>
              <span class='id identifier rubyid_render'>render</span> <span class='label'>plain:</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.new_client_not_saved</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_authenticate_user!'>authenticate_user!</span>
    <span class='ivar'>@satisfaction</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Satisfaction.html" title="Satisfaction (class)">Satisfaction</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_satisfaction_params'>satisfaction_params</span><span class='rparen'>)</span>
    <span class='ivar'>@current_folder</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Folder.html" title="Folder (class)">Folder</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:satisfaction</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:folder_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_user_id'>user_id</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
    <span class='id identifier rubyid_meta'>meta</span><span class='op'>=</span><span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_calc_meta'>calc_meta</span><span class='lparen'>(</span><span class='ivar'>@current_folder</span><span class='comma'>,</span><span class='ivar'>@current_user</span><span class='rparen'>)</span>
    <span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_case_number'>case_number</span> <span class='op'>=</span> <span class='id identifier rubyid_meta'>meta</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
      <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.user_thank_for_feedback</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='ivar'>@poll</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Poll.html" title="Poll (class)">Poll</a></span></span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_poll_id'>poll_id</span><span class='rparen'>)</span>
      <span class='ivar'>@current_folder</span><span class='period'>.</span><span class='id identifier rubyid_lists'>lists</span><span class='op'>=</span><span class='ivar'>@current_folder</span><span class='period'>.</span><span class='id identifier rubyid_calc_meta'>calc_meta</span>
      <span class='kw'>unless</span> <span class='ivar'>@current_folder</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
        <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.folder_metas</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='ivar'>@current_folder</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_content'> - </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.id</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='ivar'>@current_folder</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>&lt;br&gt;</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.not_updated</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.satisfaction_error</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_render'>render</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>new</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="destroy-instance_method">
  
    #<strong>destroy</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Destroy a specific satisfaction<br> The show form of the poll_controller
includes a delete button</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/satisfactions_controller.rb', line 311</span>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span>
  <span class='id identifier rubyid_authenticate_user!'>authenticate_user!</span>
  <span class='ivar'>@satisfaction</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Satisfaction.html" title="Satisfaction (class)">Satisfaction</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_folder_id'>folder_id</span><span class='op'>=</span><span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_folder_id'>folder_id</span>
  <span class='ivar'>@poll</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Poll.html" title="Poll (class)">Poll</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_poll_id'>poll_id</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_is_admin?'>is_admin?</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.no_permission</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='kw'>if</span> <span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
      <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.deleted</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_folder'>folder</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Folder.html" title="Folder (class)">Folder</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='id identifier rubyid_folder_id'>folder_id</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_folder'>folder</span><span class='period'>.</span><span class='id identifier rubyid_lists'>lists</span><span class='op'>=</span><span class='id identifier rubyid_folder'>folder</span><span class='period'>.</span><span class='id identifier rubyid_calc_meta'>calc_meta</span>
        <span class='kw'>unless</span> <span class='id identifier rubyid_folder'>folder</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
          <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.folder_metas_not_recorded</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>&lt;br&gt;</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.not_deleted</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_poll_path'>poll_path</span><span class='lparen'>(</span><span class='ivar'>@poll</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="feedback_metas-instance_method">
  
    #<strong>feedback_metas</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>show / update meta datas on satisfactions to upgrade from deprecated
versions of colibri (v0 or v1)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/satisfactions_controller.rb', line 12</span>

<span class='kw'>def</span> <span class='id identifier rubyid_feedback_metas'>feedback_metas</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_is_admin?'>is_admin?</span>
    <span class='id identifier rubyid_log'>log</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>you do not have the permission to update satisfactions metadatas</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:update</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_log'>log</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>checking metadatas on satisfaction records based on the folders&#39;system...\n</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_satisfactions'>satisfactions</span><span class='op'>=</span><span class='const'>Satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>folder_id &gt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='int'>0</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_satisfactions'>satisfactions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sat'>sat</span><span class='op'>|</span>
        <span class='id identifier rubyid_log'>log</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_log'>log</span><span class='embexpr_end'>}</span><span class='tstring_content'> -&gt; satisfaction </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sat'>sat</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'> on folder (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sat'>sat</span><span class='period'>.</span><span class='id identifier rubyid_folder_id'>folder_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>) metadatas are </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sat'>sat</span><span class='period'>.</span><span class='id identifier rubyid_case_number'>case_number</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_log'>log</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>updating metadatas on satisfaction records based on the folders&#39;system...\n</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_satisfactions'>satisfactions</span><span class='op'>=</span><span class='const'>Satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>folder_id &gt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='int'>0</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_satisfactions'>satisfactions</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sat'>sat</span><span class='op'>|</span>
        <span class='id identifier rubyid_meta'>meta</span><span class='op'>=</span><span class='id identifier rubyid_sat'>sat</span><span class='period'>.</span><span class='id identifier rubyid_calc_meta'>calc_meta</span>
        <span class='id identifier rubyid_sat'>sat</span><span class='period'>.</span><span class='id identifier rubyid_case_number'>case_number</span><span class='op'>=</span><span class='id identifier rubyid_meta'>meta</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comment'>#gentitle(meta[0],meta[1],meta[2])
</span>        <span class='kw'>unless</span> <span class='id identifier rubyid_sat'>sat</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
          <span class='id identifier rubyid_log'>log</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_log'>log</span><span class='embexpr_end'>}</span><span class='tstring_content'> -&gt; satisfaction </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sat'>sat</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'> on folder (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sat'>sat</span><span class='period'>.</span><span class='id identifier rubyid_folder_id'>folder_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>) updating metadatas failed\n</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_log'>log</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_log'>log</span><span class='embexpr_end'>}</span><span class='tstring_content'> -&gt; satisfaction </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sat'>sat</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'> on folder (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sat'>sat</span><span class='period'>.</span><span class='id identifier rubyid_folder_id'>folder_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>) updating metadatas OK : </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sat'>sat</span><span class='period'>.</span><span class='id identifier rubyid_case_number'>case_number</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='ivar'>@log</span><span class='op'>=</span><span class='id identifier rubyid_log'>log</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="freelist-instance_method">
  
    #<strong>freelist</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>to retrieve for a given registered user all ids for the satisfaction
answers collected out of the folders/assets system retieve also, if it
exists, the case_number field for a nicer html output</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


108
109
110
111
112
113
114
115</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/satisfactions_controller.rb', line 108</span>

<span class='kw'>def</span> <span class='id identifier rubyid_freelist'>freelist</span>
    <span class='id identifier rubyid_authenticate_user!'>authenticate_user!</span>
    <span class='id identifier rubyid_freesats'>freesats</span><span class='op'>=</span><span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_satisfactions'>satisfactions</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>folder_id &lt; ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span><span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='lbrace'>{</span><span class='label'>id:</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='label'>case_number:</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_case_number'>case_number</span><span class='rbrace'>}</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_freesats'>freesats</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='comma'>,</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
       <span class='id identifier rubyid_freesats'>freesats</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:case_number</span><span class='rbracket'>]</span><span class='op'>=</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[a-zA-Z][0-9]{1,2}[a-zA-Z]{1,2}[0-9]{1,4}</span><span class='regexp_end'>/</span></span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='symbol'>:case_number</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='id identifier rubyid_freesats'>freesats</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="freenew-instance_method">
  
    #<strong>freenew</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Show the new form in order to retrieve satisfactions from users not
registered in the Colibri<br> WEAK LOGIC PROCESS 2019<br> please note we
temporary use the folder_id field to store (-1)*@survey id<br> when
satisfaction will be recorded in the database, folder_id field will be
recycled to store the client id</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/satisfactions_controller.rb', line 122</span>

<span class='kw'>def</span> <span class='id identifier rubyid_freenew'>freenew</span>
    <span class='ivar'>@satisfaction</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Satisfaction.html" title="Satisfaction (class)">Satisfaction</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@survey</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Survey.html" title="Survey (class)">Survey</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@survey</span>
      <span class='id identifier rubyid_render'>render</span> <span class='label'>plain:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.inexisting</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> \n </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.survey</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.id</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='kw'>if</span> <span class='ivar'>@survey</span><span class='period'>.</span><span class='id identifier rubyid_token'>token</span> <span class='op'>!=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:md5</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_render'>render</span> <span class='label'>plain:</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.incorrect_md5_token</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='ivar'>@poll</span><span class='op'>=</span><span class='const'><span class='object_link'><a href="Poll.html" title="Poll (class)">Poll</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='ivar'>@survey</span><span class='period'>.</span><span class='id identifier rubyid_poll_id'>poll_id</span><span class='rparen'>)</span>
        <span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_folder_id'>folder_id</span><span class='op'>=</span><span class='op'>-</span><span class='ivar'>@survey</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
        <span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_poll_id'>poll_id</span><span class='op'>=</span><span class='ivar'>@poll</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
        <span class='id identifier rubyid_render'>render</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>freenew</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="index-instance_method">
  
    #<strong>index</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>render a json view of ALL satisfactions answers</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


96
97
98
99
100
101
102
103</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/satisfactions_controller.rb', line 96</span>

<span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
  <span class='id identifier rubyid_authenticate_user!'>authenticate_user!</span>
  <span class='id identifier rubyid_all'>all</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_satisfactions'>satisfactions</span><span class='op'>=</span> <span class='const'><span class='object_link'><a href="Satisfaction.html" title="Satisfaction (class)">Satisfaction</a></span></span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span><span class='lparen'>(</span><span class='symbol'>:user</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>satisfactions.*,users.email as email</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_polls'>polls</span><span class='op'>=</span> <span class='const'><span class='object_link'><a href="Poll.html" title="Poll (class)">Poll</a></span></span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span>
  <span class='id identifier rubyid_all'>all</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>satisfactions</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_arrange'>arrange</span><span class='lparen'>(</span><span class='id identifier rubyid_polls'>polls</span><span class='comma'>,</span><span class='id identifier rubyid_satisfactions'>satisfactions</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='id identifier rubyid_all'>all</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="json-instance_method">
  
    #<strong>json</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>render a json output of a given satisfaction<br> used in the surveys view</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/satisfactions_controller.rb', line 179</span>

<span class='kw'>def</span> <span class='id identifier rubyid_json'>json</span>
  <span class='id identifier rubyid_results'>results</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_satisfaction'>satisfaction</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Satisfaction.html" title="Satisfaction (class)">Satisfaction</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_satisfaction'>satisfaction</span>
      <span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>affaire</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.inexisting_satisfaction</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>  
  <span class='kw'>else</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_satisfaction'>satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_folder_id'>folder_id</span> <span class='op'>&gt;</span> <span class='int'>0</span>
          <span class='id identifier rubyid_folder'>folder</span><span class='op'>=</span><span class='const'>Folder</span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='id identifier rubyid_satisfaction'>satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_folder_id'>folder_id</span><span class='rparen'>)</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_folder'>folder</span>
            <span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>affaire</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_folder'>folder</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_folder'>folder</span><span class='period'>.</span><span class='id identifier rubyid_case_number'>case_number</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='op'>&gt;</span><span class='int'>0</span>
              <span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>affaire</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>affaire</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_folder'>folder</span><span class='period'>.</span><span class='id identifier rubyid_case_number'>case_number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
          <span class='id identifier rubyid_user'>user</span><span class='op'>=</span><span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='id identifier rubyid_satisfaction'>satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span>
            <span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>affaire</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>affaire</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>&lt;br&gt;Client: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
          <span class='kw'>end</span>
      <span class='kw'>else</span>
          <span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>affaire</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_satisfaction'>satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_case_number'>case_number</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>date</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_satisfaction'>satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_updated_at'>updated_at</span>
      <span class='id identifier rubyid_poll'>poll</span><span class='op'>=</span><span class='const'>Poll</span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='id identifier rubyid_satisfaction'>satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_poll_id'>poll_id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_open'>open</span><span class='op'>=</span><span class='id identifier rubyid_poll'>poll</span><span class='period'>.</span><span class='id identifier rubyid_hash_open'>hash_open</span>
      <span class='id identifier rubyid_closed'>closed</span><span class='op'>=</span><span class='id identifier rubyid_poll'>poll</span><span class='period'>.</span><span class='id identifier rubyid_hash_closed'>hash_closed</span>
      <span class='kw'>for</span> <span class='id identifier rubyid_j'>j</span> <span class='kw'>in</span> <span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_open'>open</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
        <span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='id identifier rubyid_open'>open</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>open</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_j'>j</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_satisfaction'>satisfaction</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>open</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_j'>j</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
      <span class='kw'>for</span> <span class='id identifier rubyid_j'>j</span> <span class='kw'>in</span> <span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_closed'>closed</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_satisfaction'>satisfaction</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>closed</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_j'>j</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='id identifier rubyid_closed'>closed</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>closed</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_j'>j</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_satisfaction'>satisfaction</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>closed</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_j'>j</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='kw'>else</span> 
          <span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='id identifier rubyid_closed'>closed</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>closed</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_j'>j</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='op'>=</span><span class='int'>0</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='id identifier rubyid_results'>results</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new-instance_method">
  
    #<strong>new</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Show the new form in order for public users to express their
satisfaction<br> A public user will access to the form if :<br></p>
<ul><li>
<p>he has a shared access on the folder <br></p>
</li><li>
<p>the folder is polled<br></p>
</li><li>
<p>he has not already answered to the form<br></p>
</li></ul>

<p>Both types of questions, open and closed, are not required fields</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/satisfactions_controller.rb', line 146</span>

<span class='kw'>def</span> <span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_authenticate_user!'>authenticate_user!</span>
  <span class='ivar'>@current_folder</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Folder.html" title="Folder (class)">Folder</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@current_folder</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.inexisting_folder</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_root_url'>root_url</span>
  <span class='kw'>else</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_has_ownership?'>has_ownership?</span><span class='lparen'>(</span><span class='ivar'>@current_folder</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_belongs_to_team?'>belongs_to_team?</span>
      <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.team_member_or_folder_owner</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_folder_path'>folder_path</span><span class='lparen'>(</span><span class='ivar'>@current_folder</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='kw'>return</span>
    <span class='kw'>end</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_has_shared_access?'>has_shared_access?</span><span class='lparen'>(</span><span class='ivar'>@current_folder</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.unshared_folder</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_root_url'>root_url</span> <span class='kw'>and</span> <span class='kw'>return</span>
    <span class='kw'>end</span>
    <span class='kw'>unless</span> <span class='ivar'>@current_folder</span><span class='period'>.</span><span class='id identifier rubyid_is_polled?'>is_polled?</span>
      <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.unpolled_folder</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_folder_path'>folder_path</span><span class='lparen'>(</span><span class='ivar'>@current_folder</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='kw'>return</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_has_completed_satisfaction?'>has_completed_satisfaction?</span><span class='lparen'>(</span><span class='ivar'>@current_folder</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.already_answered</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_folder_path'>folder_path</span><span class='lparen'>(</span><span class='ivar'>@current_folder</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='kw'>return</span>
    <span class='kw'>end</span>
    <span class='ivar'>@satisfaction</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Satisfaction.html" title="Satisfaction (class)">Satisfaction</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_folder_id'>folder_id</span> <span class='op'>=</span> <span class='ivar'>@current_folder</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> 
    <span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_poll_id'>poll_id</span> <span class='op'>=</span> <span class='ivar'>@current_folder</span><span class='period'>.</span><span class='id identifier rubyid_poll_id'>poll_id</span>
    <span class='ivar'>@poll</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Poll.html" title="Poll (class)">Poll</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='ivar'>@current_folder</span><span class='period'>.</span><span class='id identifier rubyid_poll_id'>poll_id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="run-instance_method">
  
    #<strong>run</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>run a filter on the results of a specific poll route is 
/satisfactions/run/:poll_id</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/satisfactions_controller.rb', line 42</span>

<span class='kw'>def</span> <span class='id identifier rubyid_run'>run</span>
  <span class='comment'>#authenticate_user!
</span>  <span class='comment'>#puts(DATE_REG_EXP)
</span>  <span class='id identifier rubyid_polls'>polls</span><span class='op'>=</span><span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_all'>all</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_poll'>poll</span><span class='op'>=</span><span class='const'>Poll</span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:poll_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_poll'>poll</span>
    <span class='id identifier rubyid_polls'>polls</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_poll'>poll</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_all'>all</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>poll_id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:poll_id</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_all'>all</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>poll_name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_poll'>poll</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:groups</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_tab'>tab</span><span class='op'>=</span><span class='id identifier rubyid_prepare'>prepare</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='comma'>,</span><span class='id identifier rubyid_poll'>poll</span><span class='period'>.</span><span class='id identifier rubyid_closed_names_number'>closed_names_number</span><span class='comma'>,</span><span class='int'>3</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_satisfactions'>satisfactions</span><span class='op'>=</span><span class='const'>Satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_find_by_sql'>find_by_sql</span><span class='lparen'>(</span><span class='id identifier rubyid_tab'>tab</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_tab'>tab</span><span class='op'>=</span><span class='id identifier rubyid_prepare'>prepare</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='comma'>,</span><span class='id identifier rubyid_poll'>poll</span><span class='period'>.</span><span class='id identifier rubyid_closed_names_number'>closed_names_number</span><span class='comma'>,</span><span class='int'>1</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_satisfactions'>satisfactions</span><span class='op'>=</span><span class='const'>Satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_find_by_sql'>find_by_sql</span><span class='lparen'>(</span><span class='id identifier rubyid_tab'>tab</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_tab'>tab</span><span class='op'>=</span><span class='id identifier rubyid_prepare'>prepare</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='comma'>,</span><span class='id identifier rubyid_poll'>poll</span><span class='period'>.</span><span class='id identifier rubyid_closed_names_number'>closed_names_number</span><span class='comma'>,</span><span class='int'>2</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_satisfactions'>satisfactions</span><span class='op'>+=</span><span class='const'>Satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_find_by_sql'>find_by_sql</span><span class='lparen'>(</span><span class='id identifier rubyid_tab'>tab</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_all'>all</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>groups</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:groups</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:start</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:end</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_all'>all</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>from</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_format_date'>format_date</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:start</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_all'>all</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_format_date'>format_date</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:end</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:ncap</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_all'>all</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ncap</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.ncap</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:ncap</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:email</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_all'>all</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>email</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.project_manager_feedbacks</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:email</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='comment'># evaluation of sent surveys only if user did not ask for csv export, ncap exploitation or filtering on a specific email
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:csv</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:ncap</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:email</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>**************parameters for count_sent_surveys (poll model) [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_all'>all</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>from</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>,</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_all'>all</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>,</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_all'>all</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>groups</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_nb'>nb</span><span class='op'>=</span><span class='id identifier rubyid_poll'>poll</span><span class='period'>.</span><span class='id identifier rubyid_count_sent_surveys'>count_sent_surveys</span><span class='lparen'>(</span><span class='id identifier rubyid_all'>all</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>from</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span><span class='id identifier rubyid_all'>all</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span><span class='id identifier rubyid_all'>all</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>groups</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_all'>all</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sent</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_nb'>nb</span>
    <span class='kw'>end</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:csv</span><span class='rbracket'>]</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_satisfactions'>satisfactions</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='op'>&gt;</span><span class='int'>0</span>
        <span class='id identifier rubyid_stats'>stats</span><span class='op'>=</span><span class='id identifier rubyid_poll'>poll</span><span class='period'>.</span><span class='id identifier rubyid_stats'>stats</span><span class='lparen'>(</span><span class='id identifier rubyid_satisfactions'>satisfactions</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_all'>all</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stats</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_stats'>stats</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_all'>all</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>satisfactions</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='id identifier rubyid_arrange'>arrange</span><span class='lparen'>(</span><span class='id identifier rubyid_polls'>polls</span><span class='comma'>,</span><span class='id identifier rubyid_satisfactions'>satisfactions</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='id identifier rubyid_all'>all</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_csv'>csv</span> <span class='op'>=</span> <span class='id identifier rubyid_poll'>poll</span><span class='period'>.</span><span class='id identifier rubyid_csv'>csv</span><span class='lparen'>(</span><span class='id identifier rubyid_satisfactions'>satisfactions</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_send_data'>send_data</span> <span class='id identifier rubyid_csv'>csv</span><span class='comma'>,</span> <span class='label'>filename:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>polls-</span><span class='embexpr_beg'>#{</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_zone'>zone</span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span><span class='embexpr_end'>}</span><span class='tstring_content'>.csv</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>message</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.inexisting</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> - </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.poll</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.id</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:poll_id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="show-instance_method">
  
    #<strong>show</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Show satisfaction answer given a specific id<br> for admins and users with
shared access on the folder related to the satisfaction</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/satisfactions_controller.rb', line 221</span>

<span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='id identifier rubyid_authenticate_user!'>authenticate_user!</span>
  <span class='ivar'>@satisfaction</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Satisfaction.html" title="Satisfaction (class)">Satisfaction</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@satisfaction</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.inexisting_satisfaction</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_root_url'>root_url</span>
  <span class='kw'>else</span>
    <span class='ivar'>@current_folder</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Folder.html" title="Folder (class)">Folder</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_folder_id'>folder_id</span><span class='rparen'>)</span>
    <span class='kw'>unless</span> <span class='lparen'>(</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_has_shared_access?'>has_shared_access?</span><span class='lparen'>(</span><span class='ivar'>@current_folder</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_is_admin?'>is_admin?</span> <span class='rparen'>)</span>
      <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sb.no_permission</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_root_url'>root_url</span> <span class='kw'>and</span> <span class='kw'>return</span>
    <span class='kw'>end</span>
    <span class='ivar'>@poll</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Poll.html" title="Poll (class)">Poll</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by_id'>find_by_id</span><span class='lparen'>(</span><span class='ivar'>@satisfaction</span><span class='period'>.</span><span class='id identifier rubyid_poll_id'>poll_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_render'>render</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>new</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Aug 20 10:01:48 2019 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.16 (ruby-2.3.3).
</div>

    </div>
  </body>
</html>