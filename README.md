rails | [jquery-rails](https://github.com/rails/jquery-rails/blob/master/VERSIONS.md) | bootstrap
--|--|--
7.0.3.1 | 4.5 | 5.2

# A business social network tool dedicated to quality management

This application is a SharingFile System with surveys management facilities

Basic open source CRM - Client Relation Management

[![Ruby](https://github.com/alexandrecuer/sharebox/actions/workflows/ruby.yml/badge.svg)](https://github.com/alexandrecuer/sharebox/actions/workflows/ruby.yml)
[![Codacy Badge](https://api.codacy.com/project/badge/Grade/ed6f26a2613349e0a92b404d515a4b29)](https://www.codacy.com/app/alexandrecuer/sharebox?utm_source=github.com&amp;utm_medium=referral&amp;utm_content=alexandrecuer/sharebox&amp;utm_campaign=Badge_Grade)

Deliver files and documents and record your clients'satisfaction
<img src=public/images/doc/colibri_front.png>

Online class documentation :
https://alexandrecuer.github.io/sharebox/

documentation generated by [yard](https://github.com/lsegal/yard) : `yard doc --private` in the root folder

To install yard : `gem install yard`

Check the wiki for architecture details and roadmap : https://github.com/alexandrecuer/sharebox/wiki

<b>
An automatic process is available for deployment on a linux Ubuntu server or virtual machine. It will install the required dependencies then the application in /var/www/colibri/sharebox.

When installing the server, reserve 8GB at least for the system and create a specific mounting point for /var/www

check : https://github.com/alexandrecuer/colibriScripts
</b>

Uses the following gems :

* [devise](https://github.com/plataformatec/devise) for user authentification
* [passenger](https://www.phusionpassenger.com/library/walkthroughs/deploy/ruby/heroku/standalone/oss/deploy_app_main.html) as the application server (in standalone mode)
* [aws-sdk](https://github.com/aws/aws-sdk-ruby) for storage on S3

frontoffice :
* [bootstrap](https://github.com/twbs/bootstrap-rubygem)
* [font-awesome](https://github.com/bokmann/font-awesome-rails) icons and cosmectic details
* [jquery rails](https://github.com/rails/jquery-rails)

## File storage

The application use rails [ActiveStorage](http://guides.rubyonrails.org/active_storage_overview.html) for file storage/documents processing 

[migration guide from paperclip](https://github.com/alexandrecuer/sharebox/issues/8)

Document storage is configured for : 
- Amazon S3 in production mode 
- local file system in development mode. In that case, the aws-sdk gem is not used.

corresponding model and controller can be found there :
- [app/models/asset.rb](app/models/asset.rb)
- [app/controllers/assets_controller.rb](app/controllers/assets_controller.rb) - see the get_file private method

to open a file, follow the route /forge/get/:id

### Switching between S3 and local storage

Modify the value of **config.active_storage.service** in the corresponding config/environments/*.rb file(s)

- config.active_storage.service = :local or :local_production > local storage will be activated
- config.active_storage.service = :amazon > all files will go in the S3 bucket

let's take the case of a file with an active_storage_blobs.key value equal to xMRXuT6nqpoiConJFQJFt6c9 :
- if local storage is activated, the file will be stored as rails_root/(storage or production_storage)/xM/RX/xMRXuT6nqpoiConJFQJFt6c9
- if S3 storage is activated, the file will be stored directly at the root of the bucket :  S3 bucket/xMRXuT6nqpoiConJFQJFt6c9

in local storage, if you delete the file the folders xM/RX will remain on disk

in lib/tasks, you can find a rake utility to clean the storage or production_storage folder

just launch :
```
bundle exec rake storage:clean_storage['storage']
bundle exec rake storage:clean_storage['storage_production']
```
empty folders will be deleted

##  S3 storage environmental variables : TO REVIEW

<table>
    <tr>
        <td>S3_BUCKET_NAME</td>
        <td><a href=https://devcenter.heroku.com/articles/s3#s3-setup>Heroku specific doc</a></td>
    </tr>
    <tr>
        <td>AWS_REGION</td>
        <td rowspan=2>
            <a href=https://docs.aws.amazon.com/fr_fr/general/latest/gr/rande.html#s3_region>AWS regional parameters</a><br> 
            exemple : <br>
            AWS_REGION=eu-west-3<br>
            AWS_HOST_NAME=s3.eu-west-3.amazonaws.com
        </td> 
    </tr>
    <tr>
        <td>AWS_HOST_NAME</td>
    </tr>
    <tr>
        <td>AWS_URL</td>
        <td>S3_BUCKET_NAME.AWS_HOST_NAME</td>
    </tr>
    <tr>
        <td>AWS_ACCESS_KEY_ID</td>
        <td rowspan=2>
            <a href=https://console.aws.amazon.com/iam/home#/users>IAM - Identity and Access Management</a>
        </td>
    </tr>
    <tr>
        <td>AWS_SECRET_ACCESS_KEY</td>
    </tr>
</table>

##  Mail delivery Environmental variables

<table>
    <tr>
        <td>GMAIL_USERNAME</td>
        <td rowspan=2>
          SendGrid is the preferred option<br>
          <a href=https://sendgrid.com/>sendgrid</a><br><br>
          <a href=https://mail.google.com/>gmail</a><br>
          Please note gmail is not a reliable solution as a backoffice mailer<br>
          if, however, you were considering using gmail for mail delivery, you may need to configure your google account in order to allow external applications to use it<br>
          <a href=https://www.google.com/settings/security/lesssecureapps>lesssecureapps</a><br>
          <a href=https://accounts.google.com/DisplayUnlockCaptcha>unlockcaptach</a><br>
        </td>
    </tr>
    <tr>
        <td>GMAIL_PASSWORD</td>
    </tr>
    <tr>
        <td>SMTP_ADDRESS</td>
        <td rowspan=2>example if using sendgrid :<br>SMTP_ADDRESS="smtp.sengrid.net"<br>SMTP_PORT=587</td>
    </tr>
    <tr>
      <td>SMTP_PORT</td>
    </tr>
    <tr>
      <td>DOMAIN</td>
      <td>In development mode : localhost<br>For a production server :ip address or domain name of the server</td>
    </tr>
</table>

# User management

5 different user profiles are available

profile 0 : external user
--
customer who is not registered in the tool and who has received a token by email to answer a satisfaction survey not related to a deliverable

profile 1 : standard public user
--
customer who wants to access a deliverable and to complete an associated satisfaction survey, if any

profile 2 : team member
--
team members can only send customer satisfaction surveys **without** making deliverables available on the cloud

a specific environmental variable TEAM permits to active the profile 2 
<table><tr><td>TEAM</td><td>cerema.fr</td></tr></table>

Initialize TEAM with your domain name - otherwise there will be no difference between profile 1 and profile 2

profile 3 : private user
--
full team member who dematerializes his productions

Private users can create directories and upload files in folders they don't own, if they have received shared access - this constitutes a primitive kind of collaborative work

profile 4 : admin
--
all powers - access to all directories and assets, surveys management, ability to modify directories (moving and changing ownership)


# Working behind a proxy server

If you work behind a proxy, please set http_proxy and https_proxy variables
```
$ export https_proxy="http://user_name:password@proxy_url:proxy_port"
$ export http_proxy="http://user_name:password@proxy_url:proxy_port"
```

# [Installation on heroku](legacy_docs/heroku.md)

# [Installation on a microsoft windows development machine](legacy_docs/install_on_microsoft_window_dev_machine.md)
